<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Race Game – Stream Safe</title>

<style>
body{
  margin:0;
  background:#0b1020;
  font-family:system-ui, Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  color:#e8eeff;
}
.wrap{width:520px}
canvas{
  width:100%;
  background:#111a33;
  border-radius:14px;
  display:block;
}
.hud{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
  font-weight:600;
}
.note{
  text-align:center;
  font-size:12px;
  opacity:0.7;
  margin-top:4px;
}
</style>
</head>

<body>
<div class="wrap">
  <div class="hud">
    <div>Pontos: <span id="score">0</span></div>
    <div>Lado IA: <span id="side">Direita</span></div>
  </div>
  <canvas id="game" width="480" height="800"></canvas>
  <div class="note">Modo stream • IA infinita • dificuldade fixa</div>
</div>

<script>
/* ================= CONFIG ================= */
const SIDES = ["left","right"]; // apenas 2 pontos de spawn
const SPEED = 380;              // dificuldade fixa
const SPAWN_INTERVAL = 1.05;    // ritmo fixo (desafio constante)

/* ================= CANVAS ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const W = canvas.width;
const H = canvas.height;

/* ================= HUD ================= */
const elScore = document.getElementById("score");
const elSide  = document.getElementById("side");

/* ================= ROAD ================= */
const road = {
  x: W / 2,
  width: W * 0.66
};

/* ================= PLAYER ================= */
const player = {
  side: "right",
  x: 0,
  y: H * 0.8,
  w: 52,
  h: 96
};

/* ================= STATE ================= */
let score = 0;
let spawnTimer = 0;
let lastSpawnSide = "left";

/* ================= OBJECTS ================= */
const enemies = [];

/* ================= POSITIONS ================= */
function sideX(side){
  const left = road.x - road.width / 2;
  const right = road.x + road.width / 2;
  const offset = road.width * 0.22;
  return side === "left"
    ? left + offset
    : right - offset;
}

/* ================= SPAWN (CONTROLADO) ================= */
function spawnEnemy(){
  // alterna o lado para nunca fechar saída
  const side = lastSpawnSide === "left" ? "right" : "left";
  lastSpawnSide = side;

  enemies.push({
    side,
    x: sideX(side),
    y: -140,
    w: 52,
    h: 96
  });
}

/* ================= IA (DETERMINÍSTICA) ================= */
function chooseSafeSide(){
  // verifica se há obstáculo à frente no lado atual
  for(const e of enemies){
    if(
      e.side === player.side &&
      e.y < player.y &&
      player.y - e.y < 260
    ){
      return player.side === "left" ? "right" : "left";
    }
  }
  return player.side;
}

/* ================= LOOP ================= */
let last = performance.now();
requestAnimationFrame(loop);

function loop(now){
  const dt = Math.min(0.033, (now - last) / 1000);
  last = now;

  update(dt);
  draw();

  requestAnimationFrame(loop);
}

/* ================= UPDATE ================= */
function update(dt){
  score += dt * 100;
  elScore.textContent = Math.floor(score);

  /* IA escolhe lado */
  player.side = chooseSafeSide();
  elSide.textContent = player.side === "left" ? "Esquerda" : "Direita";

  /* movimento suave (sem teleporte) */
  const targetX = sideX(player.side);
  player.x += (targetX - player.x) * 6 * dt;

  /* spawn fixo */
  spawnTimer += dt;
  if(spawnTimer >= SPAWN_INTERVAL){
    spawnTimer = 0;
    spawnEnemy();
  }

  /* move inimigos */
  for(let i=enemies.length-1;i>=0;i--){
    enemies[i].y += SPEED * dt;

    if(enemies[i].y > H + 300){
      enemies.splice(i,1);
    }
  }
}

/* ================= DRAW ================= */
function draw(){
  ctx.clearRect(0,0,W,H);

  ctx.fillStyle="#1b2a62";
  ctx.fillRect(0,0,W,H);

  ctx.fillStyle="#0b0f1c";
  ctx.fillRect(road.x-road.width/2,0,road.width,H);

  ctx.strokeStyle="rgba(255,255,255,0.2)";
  ctx.setLineDash([24,18]);
  ctx.lineWidth=4;
  ctx.beginPath();
  ctx.moveTo(road.x,0);
  ctx.lineTo(road.x,H);
  ctx.stroke();
  ctx.setLineDash([]);

  /* inimigos */
  ctx.fillStyle="#ff5a7a";
  for(const e of enemies){
    ctx.fillRect(e.x-e.w/2,e.y-e.h/2,e.w,e.h);
  }

  /* jogador */
  ctx.fillStyle="#4de3a5";
  ctx.fillRect(
    player.x-player.w/2,
    player.y-player.h/2,
    player.w,
    player.h
  );
}
</script>
</body>
</html>
